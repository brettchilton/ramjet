# Frontend Setup & Architecture

## Overview
The frontend is built with:
- **Vite + React + TypeScript** - Fast build tooling and type safety
- **shadcn/ui + Tailwind CSS** - Modern component library and utility-first styling
- **TanStack Router** - Type-safe client-side routing
- **TanStack Query** - Powerful data fetching and caching
- **Ory Kratos** - Production authentication (with Simple Auth for development)

## Technology Stack

### Core Dependencies
- React 18.x with TypeScript
- Vite 5.x for build tooling
- TanStack Router for routing
- TanStack Query for data management
- Tailwind CSS v4 for styling
- shadcn/ui for component library

### Authentication
- **Production**: Ory Kratos for full identity management
- **Development**: Simple auth for quick testing
- Automatic switching based on environment

## Environment Variables
Create `.env` in the project root:
```bash
# API Configuration
VITE_API_URL=http://localhost:8006

# Authentication Mode (optional - defaults to simple auth in dev)
VITE_USE_SIMPLE_AUTH=true  # Set to false to use Kratos in development

# Kratos Configuration (when using Kratos)
VITE_KRATOS_PUBLIC_URL=http://localhost:4433
VITE_KRATOS_BROWSER_URL=http://localhost:4433
```

## Installation & Development

### Local Development
```bash
cd frontend
npm install
npm run dev    # Starts dev server on http://localhost:5179
```

### Docker Development
The frontend runs in a Docker container with hot-reloading:
```bash
docker-compose up -d frontend
docker-compose logs -f frontend
```

Docker configuration in `docker-compose.yml`:
```yaml
frontend:
  build: ./frontend
  ports:
    - '5179:5179'
  volumes:
    - ./frontend:/app
    - /app/node_modules
  environment:
    - VITE_API_URL=${VITE_API_URL}
    - VITE_USE_SIMPLE_AUTH=${VITE_USE_SIMPLE_AUTH}
```

## UI Framework: shadcn/ui

The project uses shadcn/ui components with Tailwind CSS for styling:

### Component Library
Located in `src/components/ui/`:
- `button.tsx` - Button variants and styles
- `card.tsx` - Card containers
- `input.tsx` - Form inputs
- `label.tsx` - Form labels
- `form.tsx` - Form components with react-hook-form
- `checkbox.tsx` - Checkbox inputs
- `alert.tsx` - Alert messages
- `tabs.tsx` - Tab navigation
- `dialog.tsx`, `sheet.tsx` - Modal dialogs
- `select.tsx`, `switch.tsx`, `textarea.tsx` - Additional form controls

### Styling Approach
- **Tailwind CSS v4** with CSS variables for theming
- **Dark mode support** via `dark` class on root element
- **Responsive design** with Tailwind's responsive utilities
- **Custom theme** defined in `tailwind.config.js` and `src/index.css`

### Adding New Components
```bash
npx shadcn@latest add <component-name>
```

## Authentication Architecture

### Dual Authentication System
The app supports two authentication modes:

1. **Ory Kratos** (Production)
   - Full identity management
   - Self-service flows (login, registration, recovery, verification)
   - Secure session management
   - Hook: `src/hooks/useKratos.tsx`

2. **Simple Auth** (Development)
   - Quick JWT-based authentication
   - No external dependencies
   - Fast development iteration
   - Context: `src/contexts/SimpleAuthContext.tsx`

### Unified Auth Hook
Use `useUnifiedAuth()` for authentication in components:
```tsx
import { useUnifiedAuth } from '../hooks/useUnifiedAuth';

function MyComponent() {
  const { user, isAuthenticated, logout } = useUnifiedAuth();
  
  if (!isAuthenticated) {
    return <Navigate to="/auth/login" />;
  }
  
  return <div>Welcome {user?.first_name}!</div>;
}
```

### Auth Flow Components
- `src/components/KratosFlow.tsx` - Dynamic form renderer for Kratos UI nodes
- `src/components/AuthGuard.tsx` - Route protection component
- `src/contexts/AuthContext.tsx` - Kratos auth provider
- `src/services/kratosService.ts` - Kratos API client

## Routing Structure

Routes are defined in `src/routes/` using TanStack Router:

### Public Routes
- `/auth/login` - Login page
- `/auth/registration` - Sign up page
- `/auth/recovery` - Password recovery
- `/auth/verification` - Email verification
- `/auth/error` - Auth error handling

### Protected Routes
- `/` - Dashboard (redirects to login if not authenticated)
- `/dashboard` - Main dashboard
- `/orders` - Orders dashboard (filterable table, email monitor status)
- `/orders/{orderId}` - Order review page (source panel, extracted data, form preview)
- `/settings` - User settings with tabs
- `/logout` - Logout handler

### Route Configuration
Routes are auto-generated by TanStack Router CLI:
```bash
npm run dev  # Automatically generates route tree
```

## Project Structure
```
frontend/
├── src/
│   ├── components/
│   │   ├── ui/          # shadcn/ui components
│   │   ├── orders/      # Order automation components
│   │   │   ├── ConfidenceBadge.tsx
│   │   │   ├── StatusBadge.tsx
│   │   │   ├── OrderSourcePanel.tsx
│   │   │   ├── OrderDataForm.tsx
│   │   │   ├── FormPreview.tsx
│   │   │   ├── OrderActions.tsx
│   │   │   └── RejectDialog.tsx
│   │   ├── Layout/      # App layout components
│   │   ├── AuthGuard.tsx
│   │   ├── KratosFlow.tsx
│   │   └── RootLayout.tsx
│   ├── contexts/        # React contexts
│   │   ├── AuthContext.tsx
│   │   └── SimpleAuthContext.tsx
│   ├── hooks/           # Custom React hooks
│   │   ├── useAuth.tsx
│   │   ├── useKratos.tsx
│   │   ├── useUnifiedAuth.tsx
│   │   └── useOrders.ts         # Order data hooks (TanStack Query)
│   ├── routes/          # Route components
│   │   ├── auth/        # Auth flow routes
│   │   ├── orders/
│   │   │   ├── index.tsx        # Orders dashboard
│   │   │   └── $orderId.tsx     # Order review page
│   │   ├── dashboard.tsx
│   │   ├── index.tsx
│   │   └── settings.tsx
│   ├── services/        # API services
│   │   ├── kratosService.ts
│   │   └── orderService.ts      # Order API client
│   ├── types/           # TypeScript interfaces
│   │   └── orders.ts            # Order type definitions
│   ├── lib/            # Utilities
│   │   └── utils.ts
│   ├── main.tsx        # App entry point
│   └── index.css       # Global styles
├── public/             # Static assets
├── components.json     # shadcn/ui config
├── tailwind.config.js  # Tailwind configuration
├── tsconfig.json       # TypeScript config
├── vite.config.ts      # Vite configuration
└── package.json
```

## Building for Production
```bash
cd frontend
npm run build    # TypeScript check + Vite build
npm run preview  # Preview production build locally
```

The build output in `dist/` can be deployed to any static hosting service.

## Development Tips

### Hot Module Replacement
- Vite provides instant HMR for React components
- Tailwind classes update without page reload
- Route changes may require page refresh

### TypeScript
- Strict mode enabled for better type safety
- Use proper types for all props and state
- API responses should have defined interfaces

### Component Development
1. Use shadcn/ui components as base
2. Extend with Tailwind classes for custom styling
3. Keep components small and focused
4. Use composition over inheritance

### State Management
- Local state with `useState` for component state
- Context API for global auth state
- TanStack Query for server state
- No additional state management library needed

## Common Tasks

### Adding a New Route
1. Create component in `src/routes/`
2. Run dev server to auto-generate route
3. Add navigation link if needed

### Customizing shadcn Components
1. Modify component in `src/components/ui/`
2. Update CSS variables in `src/index.css` for theme changes
3. Use `cn()` utility for conditional classes

### Switching Auth Modes
- Development: Automatically uses Simple Auth
- Production: Automatically uses Kratos
- Override: Set `VITE_USE_SIMPLE_AUTH` env variable

## Troubleshooting

### Common Issues
1. **"use client" errors**: Remove these Next.js directives from components
2. **Tailwind not working**: Ensure content paths in config include all component files
3. **Auth redirect loops**: Check auth provider configuration and API endpoints
4. **Build errors**: Run `npm run build` to catch TypeScript errors early

### Debug Mode
- Browser DevTools for React components
- Network tab for API calls
- Console logs in auth flows for debugging

---
*Last updated after shadcn/ui migration and removal of MUI components*